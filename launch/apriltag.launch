<launch>
    <arg name="launch_prefix" default=""/>
    <arg name="node_namespace" default="apriltag_ros_continuous_node"/>
    <arg name="camera_name" default="/docking_camera"/>
    <arg name="camera_frame" default="camera"/>
    <arg name="image_topic" default="/image_raw"/>

    <!-- Set parameters -->
    <rosparam command="load" file="$(find panther_driver)/config/apriltags_settings.yaml" ns="$(arg node_namespace)"/>
    <rosparam command="load" file="$(find panther_driver)/config/apriltags_tags.yaml" ns="$(arg node_namespace)"/>

    <node pkg="apriltag_ros" type="apriltag_ros_continuous_node" name="$(arg node_namespace)" clear_params="true" output="screen" launch-prefix="$(arg launch_prefix)">
        <remap from="image_rect" to="$(arg camera_name)/$(arg image_topic)"/>
        <remap from="camera_info" to="$(arg camera_name)/camera_info"/>
        <param name="camera_frame" type="str" value="$(arg camera_frame)"/>
        <param name="publish_tag_detections_image" type="bool" value="true"/>
    </node>

    <node pkg="cv_camera" type="cv_camera_node" name="docking_camera" clear_params="true" output="log">
        <param name="rate" value="30"/>
        <param name="device_id" value="0"/>
        <param name="frame_id" value="camera"/>
        <param name="image_width" value="1920"/>
        <param name="image_height" value="1080"/>
    </node>

    <include file="$(find panther_driver)/launch/docking.launch">
    </include>

    <node pkg="tf" type="static_transform_publisher" name="power_station" args="0 -0.29 0.51 0 0 0 power_station_tag power_station 100" />
    <node pkg="tf" type="static_transform_publisher" name="power_receiver" args="0.525 0 0.15 0 0 0 base_link power_receiver 100" />
    <node pkg="tf" type="static_transform_publisher" name="receiver_camera" args="0 0 0.07 1.5707 0 1.5707 power_receiver camera 100" />

</launch>
